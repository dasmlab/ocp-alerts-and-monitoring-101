# Alert Trigger Demo App

This application is designed to trigger various alerts for demonstration purposes during Module 3 presentations.

## Overview

The Alert Trigger Demo App exposes metrics that can be used to trigger alerts defined in PrometheusRules. It provides a web interface to manually trigger different alert conditions, making it perfect for live demonstrations.

## Features

- **Web Interface**: Easy-to-use web UI to trigger alerts
- **Prometheus Metrics**: Exposes metrics that match common alert rules
- **Multiple Alert Types**: Can trigger CPU, Memory, and Error Rate alerts
- **Real-time Control**: Instantly trigger or reset alert conditions

## Available Metrics

The app exposes the following Prometheus metrics:

- `alert_demo_cpu_usage_percent` - CPU usage percentage (0-100)
- `alert_demo_memory_usage_percent` - Memory usage percentage (0-100)
- `alert_demo_error_rate_percent` - Error rate percentage (0-100)
- `alert_demo_http_requests_total` - Total HTTP requests
- `alert_demo_http_errors_total` - Total HTTP errors

## Deployment

1. Build the container image:
   ```bash
   docker build -t alert-trigger-app:latest .
   # Tag and push to your registry if needed
   ```

2. Deploy the application:
   ```bash
   oc apply -f deployment.yaml
   ```

3. Access the application:
   ```bash
   oc port-forward -n demo-app svc/alert-trigger-app 8080:8080
   ```

4. Open http://localhost:8080/ in your browser

## Usage

### Triggering Alerts

1. **High CPU Alert**: 
   - Click "Trigger High CPU Alert" or visit `/trigger?action=high_cpu`
   - Sets CPU usage to 85% (above the 80% threshold)
   - Alert should fire after 1 minute

2. **High Memory Alert**:
   - Click "Trigger High Memory Alert" or visit `/trigger?action=high_memory`
   - Sets memory usage to 95% (above the 90% threshold)
   - Alert should fire after 1 minute

3. **High Error Rate Alert**:
   - Click "Trigger High Error Rate" or visit `/trigger?action=high_errors`
   - Sets error rate to 10% (above the 5% threshold)
   - Alert should fire after 1 minute

4. **Reset Metrics**:
   - Click "Reset All Metrics" or visit `/trigger?action=reset`
   - Resets all metrics to normal values
   - Alerts should resolve

### Viewing Metrics

- **Prometheus**: Query `alert_demo_cpu_usage_percent`, `alert_demo_memory_usage_percent`, etc.
- **Metrics Endpoint**: http://localhost:8080/metrics
- **Web UI**: http://localhost:8080/ shows current metric values

## Alert Rules

The deployment includes example PrometheusRules that will trigger based on the app's metrics:

- `HighCPUUsageDemo` - Fires when CPU > 80% for 1 minute
- `HighMemoryUsageDemo` - Fires when Memory > 90% for 1 minute
- `HighErrorRateDemo` - Fires when Error Rate > 5% for 1 minute

## Demonstration Flow

1. **Show Normal State**:
   - Deploy the app
   - Show metrics in Prometheus
   - Verify no alerts are firing

2. **Trigger an Alert**:
   - Use the web UI to trigger high CPU
   - Show metrics changing in Prometheus
   - Wait for alert to fire (1 minute)
   - Show alert in AlertManager UI

3. **Show Alert Routing**:
   - Verify alert is routed to the correct receiver (Slack/Email/Webhook)
   - Show notification received

4. **Resolve Alert**:
   - Reset metrics using the web UI
   - Show alert resolving
   - Show resolved notification

## Integration with AlertManager

The alerts generated by this app will be routed according to your AlertManager configuration:

- **Critical alerts** (HighErrorRateDemo) → Email + Slack + Webhook
- **Warning alerts** (HighCPUUsageDemo, HighMemoryUsageDemo) → Slack

Make sure your AlertManager is configured with the appropriate receivers (see `example-alertmanager-cr.yaml`).

## Troubleshooting

- **Alerts not firing**: 
  - Check that ServiceMonitor is applied and Prometheus is scraping
  - Verify PrometheusRule is applied in the correct namespace
  - Check alert rule evaluation in Prometheus UI

- **Metrics not updating**:
  - Verify the app is running: `oc get pods -n demo-app`
  - Check app logs: `oc logs -n demo-app -l app=alert-trigger-app`
  - Verify ServiceMonitor is discovering the target

- **Can't access web UI**:
  - Ensure port-forward is running
  - Check service is created: `oc get svc -n demo-app`

## Cleanup

To remove all resources:

```bash
oc delete -f deployment.yaml
```

